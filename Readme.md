# Javascript / Node.js Code Style Guide

This is a guide for writing consistent and aesthetically pleasing node.js code.
It is inspired by what is popular within the community, and flavored with some
personal opinions.

This guide was originally created by [Felix Geisend√∂rfer](http://felixge.de/) and is
licensed under the [CC BY-SA 3.0](http://creativecommons.org/licenses/by-sa/3.0/)
license. You are encouraged to fork this repository and make adjustments
according to your preferences.

![Creative Commons License](http://i.creativecommons.org/l/by-sa/3.0/88x31.png)
## 4 Spaces for indention

Whole project team should use the same settings for indention. 4 spaces chosen regarding
fact that we're already have an agreement to use 4 spaces in our project. 
It is recommended to setup your editor to display \t symbols in order to keep code clean.

## No trailing whitespace

Leaving trailing whitespaces has the feeling of a dirty careless code and pretty easy to 
avoid. It is strong recomendation to set-up your editor to display trailing whitespaces and
always remove them when you work with code.

## Use Semicolons

Since javascrtipt doesn't treat line breaks as a statement termination and putting semicolons
in the runtime automatically it is a good idea to help parser does not make a mistake. And avoid
weird hard to debug problems.

## 80 characters per line

Keep your code in the limit of 80 characters. This makes code easier to read and understand.
Also think about split screen. This is a soft recommendation but please set-up your editor to 
display virtual line at the 80th character and avoid crossing it.

## Use single quotes

Use single quotes, unless you are writing JSON.

*Right:*

```js
var foo = 'bar';
```

*Wrong:*

```js
var foo = "bar";
```

## Opening braces go on the same line

Your opening braces go on the same line as the statement.

*Right:*

```js
if (true) {
  console.log('winning');
}
```

*Wrong:*

```js
if (true)
{
  console.log('losing');
}
```

Also, notice the use of whitespace before and after the condition statement.

## Declare one variable per var statement

Declare one variable per var statement, it makes it easier to re-order the
lines. Ignore [Crockford][crockfordconvention] on this, and put those
declarations wherever they make sense.

*Right:*
```js
var keys = ['foo', 'bar'],
    values = [23, 42],
    object = {},
    key;

var object = {};
while (items.length) {
  key = keys.pop();
  object[key] = values.pop();
}
```

[crockfordconvention]: http://javascript.crockford.com/code.html

## Use lowerCamelCase for variables, properties and function names

Variables, properties and function names should use `lowerCamelCase`.  They
should also be descriptive. Single character variables and uncommon
abbreviations should generally be avoided.

*Right:*

```js
var adminUser = db.query('SELECT * FROM users ...');
```

*Wrong:*

```js
var admin_user = db.query('SELECT * FROM users ...');
```

*Wrong:*

```js
this.active = function() {
    return this.isActive;
}
```
*Wrong:*

```js
this.isActive = function() {
    return this.active;
}
```
*Right:*
```js
this.getIsActive = function() {
    return this.isActive === true;
}
```

## Use UpperCamelCase for class names

Class names should be capitalized using `UpperCamelCase`.

*Right:*

```js
function BankAccount() {
}
```

*Wrong:*

```js
function bank_Account() {
}
```

## Use UPPERCASE for Constants

Constants should be declared as regular variables or static class properties,
using all uppercase letters.

Node.js / V8 actually supports mozilla's [const][const] extension, but
unfortunately that cannot be applied to class members, nor is it part of any
ECMA standard.

*Right:*

```js
var SECOND = 1 * 1000;

function File() {
}
File.FULL_PERMISSIONS = 0777;
```

*Wrong:*

```js
const SECOND = 1 * 1000;

function File() {
}
File.fullPermissions = 0777;
```

[const]: https://developer.mozilla.org/en/JavaScript/Reference/Statements/const

## Variable names should refer to an identifier. 


```js
function SelectAllUsersWhereDobIsGreaterThan1980AndIsMaleOrderByNameAndAge() {}
var instrumentAreaDockWidgetVisibilityFollowsChildPresence;
```

## Name files alllowercase. Use dashes to separate words, use dots to separate logical parts.
*Wrong:*
```
myNewModule-1.0.js
my_new_module.1-0.js
my new module.10.js
My-new-module.1.0.js
```

*Right:*
```
my-new-module-1.0.js
```
## Each class/module should have separate file

Defining more than one class in a single file makes it harder to:
* reason about a single class in isolation 
* find a specific class in your file system
* merge changes from different developers


## Object / Array creation

Use trailing commas and put *short* declarations on a single line. Only quote
keys when your interpreter complains:

*Right:*

```js
var a = ['hello', 'world'];
var b = {
  good: 'code',
  'is generally': 'pretty',
};
```

*Wrong:*

```js
var a = [
  'hello', 'world'
];
var b = {"good": 'code'
        , is generally: 'pretty'
        };
```

## Use the === operator

Programming is not about remembering [stupid rules][comparisonoperators]. Use
the triple equality operator as it will work just as expected.

*Right:*

```js
var a = 0;
if (a === '') {
  console.log('winning');
}

```

*Wrong:*

```js
var a = 0;
if (a == '') {
  console.log('losing');
}
```

[comparisonoperators]: https://developer.mozilla.org/en/JavaScript/Reference/Operators/Comparison_Operators

## Use multi-line ternary operator

The ternary operator should not be used on a single line. Split it up into multiple lines instead.

*Right:*

```js
var foo = (a === b)
  ? 1
  : 2;
```

*Wrong:*

```js
var foo = (a === b) ? 1 : 2;
```

## Do not extend built-in prototypes

Extending the prototype of native JavaScript objects is evil, hovewer [sometimes][es5shim] it is the only way
to provide IE support for less. 
Do not extend the prototype of native JavaScript objects in all other cases.

*Right:*

```js
var a = [];
if (!a.length) {
  console.log('winning');
}
```

*Wrong:*

```js
Array.prototype.empty = function() {
  return !this.length;
}

var a = [];
if (a.empty()) {
  console.log('losing');
}
```

[es5shim]:https://github.com/kriskowal/es5-shim

## Use descriptive conditions

Any non-trivial conditions should be assigned to a descriptive variable:

*Right:*

```js
var isAuthorized = (user.getIsAdmin() || user.getIsModerator());
if (isAuthorized) {
  console.log('winning');
}
```

*Wrong:*

```js
if (user.getIsAdmin() || user.getIsModerator()) {
  console.log('losing');
}
```

## Write small functions

Keep your functions short. A good function fits on a slide that the people in
the last row of a big room can comfortably read. So don't count on them having
perfect vision and limit yourself to ~15 lines of code per function.

## Return early from functions

To avoid deep nesting of if-statements, always return a functions value as early
as possible.

*Right:*

```js
function isPercentage(val) {
  if (val < 0) {
    return false;
  }

  if (val > 100) {
    return false;
  }

  return true;
}
```

*Wrong:*

```js
function isPercentage(val) {
  if (val >= 0) {
    if (val < 100) {
      return true;
    } else {
      return false;
    }
  } else {
    return false;
  }
}
```

Or for this particular example it may also be fine to shorten things even
further:

```js
function isPercentage(val) {
  var isInRange = (val >= 0 && val <= 100);
  return isInRange;
}
```

## Name your closures

Feel free to give your closures a name. It shows that you care about them, and
will produce better stack traces, heap and cpu profiles.

*Right:*

```js
req.on('end', function onEnd() {
  console.log('winning');
});
```

*Wrong:*

```js
req.on('end', function() {
  console.log('losing');
});
```

## No nested closures

Use closures, but don't nest them. Otherwise your code will become a mess.

*Right:*

```js
setTimeout(function() {
  client.connect(afterConnect);
}, 1000);

function afterConnect() {
  console.log('winning');
}
```

*Wrong:*

```js
setTimeout(function() {
  client.connect(function() {
    console.log('losing');
  });
}, 1000);
```

## Use slashes for comments

Use slashes for both single line and multi line comments. Try to write
comments that explain higher level mechanisms or clarify difficult
segments of your code. Don't use comments to restate trivial things.

*Right:*

```js
// 'ID_SOMETHING=VALUE' -> ['ID_SOMETHING=VALUE'', 'SOMETHING', 'VALUE']
var matches = item.match(/ID_([^\n]+)=([^\n]+)/));

// This function has a nasty side effect where a failure to increment a
// redis counter used for statistics will cause an exception. This needs
// to be fixed in a later iteration.
function loadUser(id, cb) {
  // ...
}

var isSessionValid = (session.expires < Date.now());
if (isSessionValid) {
  // ...
}
```

*Wrong:*

```js
// Execute a regex
var matches = item.match(/ID_([^\n]+)=([^\n]+)/));

// Usage: loadUser(5, function() { ... })
function loadUser(id, cb) {
  // ...
}

// Check if the session is valid
var isSessionValid = (session.expires < Date.now());
// If the session is valid
if (isSessionValid) {
  // ...
}
```
Multiline comments are wrong also. Comment each line separately.

*Wrong:* 
```js
/* //Check if the session is valid
var isSessionValid = (session.expires < Date.now());
if (isSessionValid) {
  // ...
}*/
```
*Right:* 
```js
//// Check if the session is valid
//var isSessionValid = (session.expires < Date.now());
//if (isSessionValid) {
//  // ...
//}*/
```
## Remove your debug output before pull request

As an exception It is only allowed to keep debug info for the tasks you're working on currently.
Think about other developpers who also want to see their own (temporary) debug output.

## Object.freeze, Object.preventExtensions, Object.seal, with, eval

Avoid using them.
